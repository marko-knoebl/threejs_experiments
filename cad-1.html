<html>
	<head>
		<meta charset="utf-8">
		<title>My first Three.js app</title>
	</head>
	<body>
		<script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
		<script>
		"use strict";
		// a simple viewer with camera controls which has the z-axis vertical

		var scene, camera, renderer, render;
		var cube, wireGeom, wireMat, wire;
		var cameraContainer;
		
		var lmbdown; // left mouse button down

		// set the document style (CSS)
		document.body.style.margin = '0px';
		document.body.style.backgroundColor = '#eeeeee';
		document.body.style.fontFamily = 'Arimo, "Liberation Sans", Arial, Helvetica, sans-serif';
		document.body.style.fontSize = '16';
		
		// vertical split
		var leftSidebar = document.createElement('div');
		leftSidebar.style.cssFloat = 'left';
		leftSidebar.style.width = '200px';
		leftSidebar.style.backgroundColor = '#dddddd';
		document.body.appendChild(leftSidebar);
		
		var toolSelector = document.createElement('select');
		var t;
		t = document.createElement('option');
		t.text = t.value = 'Sphere';
		toolSelector.add(t, 0);
		t = document.createElement('option');
		t.text = t.value = 'Box';
		toolSelector.add(t, 0);
		leftSidebar.appendChild(toolSelector);
		
		toolSelector.onchange = function() {
			if (toolSelector.value === 'Sphere') {
				activateSpehereTool();
			} else if (toolSelector.value === 'Box') {
				activateBoxTool();
			}
		};
		
		var objectDetails = document.createElement('div');
		objectDetails.style.backgroundColor = '#dddddd';
		leftSidebar.appendChild(objectDetails);

		// set up 3d view
		scene = new THREE.Scene();
		camera = new THREE.PerspectiveCamera( 50, (window.innerWidth - 200) / window.innerHeight, 0.1, 1000 );
		renderer = new THREE.WebGLRenderer({antialias: true});
		renderer.setClearColor(0xf6f6f6, 1);
		renderer.setSize(window.innerWidth - 200, window.innerHeight);
		renderer.domElement.style.cssFloat = 'right';
		renderer.domElement.style.width = (window.innerWidth - 200).toString() + 'px';
		renderer.domElement.style.height = (window.innerHeight).toString() + 'px';
		document.body.appendChild( renderer.domElement );

		// set up the camera so the z-axis is vertical
		camera.rotation.order = 'ZYX';
		camera.rotation.set(Math.PI/2, 0, Math.PI/2);

		// make a container for the newly oriented camera to control its orientation
		cameraContainer = new THREE.Object3D();
		cameraContainer.add(camera);
		cameraContainer.position.set(20, 0, 0);
		cameraContainer.rotation.order = 'ZYX';
		cameraContainer.ang = {'_phi': 0, '_theta': 0};
		Object.defineProperty(cameraContainer.ang, 'phi', {
				get: function() {return cameraContainer.ang._phi;},
				set: function(phi_) {
					var theta_
					cameraContainer.ang._phi = phi_;
					theta_ = cameraContainer.ang._theta;
					cameraContainer.rotation.set(0, -cameraContainer.ang._theta, cameraContainer.ang._phi);
					cameraContainer.position.set(20 * Math.cos(phi_) * Math.cos(theta_), 20 * Math.sin(phi_) * Math.cos(theta_), 20 * Math.sin(theta_));
				}
			}
		);
		Object.defineProperty(cameraContainer.ang, 'theta', {
				get: function() {return cameraContainer.ang._theta;},
				set: function(theta_) {
					var phi_
					cameraContainer.ang._theta = theta_;
					phi_ = cameraContainer.ang._phi;
					cameraContainer.rotation.set(0, -cameraContainer.ang._theta, cameraContainer.ang._phi);
					cameraContainer.position.set(20 * Math.cos(phi_) * Math.cos(theta_), 20 * Math.sin(phi_) * Math.cos(theta_), 20 * Math.sin(theta_));
				}
			}
		);
		scene.add(cameraContainer);

		// create objects
		cube = new THREE.Mesh(
			new THREE.BoxGeometry(1, 1, 1),
			new THREE.MeshPhongMaterial({color: 0x00ff00, shading:THREE.FlatShading})
		);
		cube.position.z = 3;
		scene.add( cube );
		
		wireGeom = new THREE.Geometry();
		wireGeom.vertices.push(new THREE.Vector3(-1, 0, 0));
		wireGeom.vertices.push(new THREE.Vector3(1, 3, 3));
		wireGeom.vertices.push(new THREE.Vector3(5, -2, 0));
		wireMat = new THREE.LineBasicMaterial({color: 0xff00ff, shading: THREE.FlatShading});
		wire = new THREE.Line(wireGeom, wireMat);
		scene.add(wire);

		// create lights
		var light = new THREE.SpotLight( 0xffffff, 1.5 );
		light.position.set( 400, 500, 2000 );
		light.castShadow = true;
		light.shadowCameraNear = 0;
		light.shadowCameraFar = camera.far;
		light.shadowCameraFov = 50;
		light.shadowBias = -0.00022;
		light.shadowDarkness = 0.5;
		light.shadowMapWidth = 2048;
		light.shadowMapHeight = 2048;
		scene.add( light );

		var ambientLight = new THREE.AmbientLight(0x202020);
		scene.add(ambientLight);

		// create empty geometry
		var selectedObject = new THREE.Mesh(
			new THREE.Geometry(),
			new THREE.MeshPhongMaterial({color: 0x00ff00, shading:THREE.SmoothShading})
		);
		selectedObject.geometry.dynamic = true;
		scene.add(selectedObject);
		
		var createInput = function(name, default_, onchange) {
			currentInput[name] = default_;
			var input;
			input = document.createElement('div');
			input.innerHTML = name + ': ';
			input.style.margin = '5px';
			var inputField;
			inputField = document.createElement('input');
			inputField.type = 'number';
			// allow fractions as input
			inputField.step = 'any';
			inputField.value = default_;
			inputField.style.width = '60px';
			input.appendChild(inputField);
			objectDetails.appendChild(input);
			inputField.onchange = onchange;
		};
		
		var currentInput = {};
		
		var removeInputs = function() {
			while (objectDetails.firstChild) {
				objectDetails.removeChild(objectDetails.firstChild);
			}
		};
		
		var activateBoxTool = function() {
			removeInputs();
			
			createInput(
				'Height',
				'1',
				function() {
					currentInput['Height'] = parseFloat(this.value);
					scene.remove(selectedObject);
					selectedObject = new THREE.Mesh(
						new THREE.BoxGeometry(currentInput['Depth'], currentInput['Width'], currentInput['Height']),
						new THREE.MeshPhongMaterial({color: 0x00ff00, shading:THREE.SmoothShading})
					);
					selectedObject.position.set(currentInput['Depth']/2, currentInput['Width']/2, currentInput['Height']/2);
					scene.add(selectedObject);
					renderer.render(scene, camera);
				}
			);
			
			createInput(
				'Width',
				'1',
				function() {
					currentInput['Width'] = parseFloat(this.value);
					scene.remove(selectedObject);
					selectedObject = new THREE.Mesh(
						new THREE.BoxGeometry(currentInput['Depth'], currentInput['Width'], currentInput['Height']),
						new THREE.MeshPhongMaterial({color: 0x00ff00, shading:THREE.SmoothShading})
					);
					selectedObject.position.set(currentInput['Depth']/2, currentInput['Width']/2, currentInput['Height']/2);
					scene.add(selectedObject);
					renderer.render(scene, camera);
				}
			);
			
			createInput(
				'Depth',
				1,
				function() {
					currentInput['Depth'] = parseFloat(this.value);
					scene.remove(selectedObject);
					selectedObject = new THREE.Mesh(
						new THREE.BoxGeometry(currentInput['Depth'], currentInput['Width'], currentInput['Height']),
						new THREE.MeshPhongMaterial({color: 0x00ff00, shading:THREE.SmoothShading})
					);
					selectedObject.position.set(currentInput['Depth']/2, currentInput['Width']/2, currentInput['Height']/2);
					scene.add(selectedObject);
					renderer.render(scene, camera);
				}
			);
		};
		
		var activateSpehereTool = function() {
		
			removeInputs();
		
			createInput(
				'Radius',
				'1',
				function() {
					currentInput['Radius'] = this.value;
					scene.remove(selectedObject);
					selectedObject = new THREE.Mesh(
						new THREE.SphereGeometry(parseFloat(currentInput['Radius']), 24, 18),
						new THREE.MeshPhongMaterial({color: 0x00ff00, shading:THREE.SmoothShading})
					);
					selectedObject.position.z = parseFloat(currentInput['z']);
					scene.add(selectedObject);
					renderer.render(scene, camera);
				}
			);
		
			createInput(
				'z',
				'0',
				function() {
					currentInput['z'] = this.value;
					scene.remove(selectedObject);
					//geom.position.z = parseFloat(this.value);
					selectedObject = new THREE.Mesh(
						new THREE.SphereGeometry(parseFloat(currentInput['Radius']), 24, 18),
						new THREE.MeshPhongMaterial({color: 0x00ff00, shading:THREE.SmoothShading})
					);
					selectedObject.position.z = parseFloat(currentInput['z']);
					scene.add(selectedObject);
					renderer.render(scene, camera);
				}
			);
		};
		
		window.addEventListener(
			'resize',
			function(event) {
				// update aspect ratios
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
				renderer.render(scene, camera);
				},
			false
		);

		var mouseDragStart;
		mouseDragStart = {x:0, y:0, z:0};

		var mouse2D = new THREE.Vector3(1, 1, 1);

		document.addEventListener(
			'mousedown',
			function(event) {
				// store the normalized mouse position
				mouseDragStart.x = mouse2D.x;
				mouseDragStart.y = mouse2D.y;
				if (event.button === 0) {
					lmbdown = true;
				}
			},
			false
		);

		document.addEventListener(
			'mouseup',
			function(event) {
				if (event.button === 0) {
					lmbdown = false;
				}
			},
			false
		);

		document.addEventListener(
			'mousemove',
			function(event) {
				mouse2D.x = (event.clientX / window.innerWidth) * 2 - 1;
				mouse2D.y = - (event.clientY / window.innerHeight) * 2 + 1;
				var dx, dy;
				dx = mouse2D.x - mouseDragStart.x;
				dy = mouse2D.y - mouseDragStart.y;
				mouseDragStart.x = mouse2D.x;
				mouseDragStart.y = mouse2D.y;
				if (!lmbdown) {
					return;
				}
				cameraContainer.ang.phi -= dx * 150/180*Math.PI;
				cameraContainer.ang.theta -= dy * 150/180*Math.PI;
				renderer.render(scene, camera);
			},
			false
		);

		document.addEventListener(
			'mousemove',
			function(event) {
				if (event.button === 1) {
				}
			}
		);

		document.addEventListener(
			'keydown',
			function(event) {
				if (event.which === 39) {
					cameraContainer.ang.phi += 0.04;
					renderer.render(scene, camera);
				} else if (event.which === 37) {
					cameraContainer.ang.phi -= 0.04;
					renderer.render(scene, camera);
				} else if (event.which === 38) {
					cameraContainer.ang.theta += 0.04;
					renderer.render(scene, camera);
				} else if (event.which === 40) {
					cameraContainer.ang.theta -= 0.04;
					renderer.render(scene, camera);
				} else if (event.which === 13) {
					// enter
					var newObject = selectedObject.clone();
					scene.add(newObject);
					renderer.render(scene, camera);
				}
			},
			false
		);
		renderer.render(scene, camera);
		</script>
	</body>
</html>
